{% extends 'base.html' %}


{% block title %} Swap {% endblock %}


{% block body %}
<html>
<head>
<title>Swap Book</title>
        <!-- Link allow you to use python with HTML -->
        <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
        <script defer src="https://pyscript.net/alpha/pyscript.js"></script> 
        
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<style>
    .container {
        background-color: black;
        color: white;
    }
</style>
</head>
<body>

  <py-script>

    import random
    swapped_with =[]

    def swap_table(l):
      def shuffle_records(records):
          shuffled_records = random.sample(records, len(records))
          return shuffled_records

      def book_swap(l):
          records = [(record[0], record[3], record[5], record[2]) for record in l]
          shuffled = shuffle_records(records)
          swapped = set()
          for i, record in enumerate(l):
              while (record[0], shuffled[i][1]) in swapped or shuffled[i][1] == record[2] or shuffled[i][3] == record[3]:
                  random.shuffle(shuffled)
              record[3] = shuffled[i][1]
              swapped.add((record[0], record[3]))
              swapped_with.append([record[0],record[3]])
          return l,swapped_with
    
      l, swapped_books = book_swap(l)
      return l, swapped_books

    l = [["ID 1" , "Title 1", "Main Owner 1", "New Owner 1", "BookId 1", "UserId 1"],
         ["ID 2" , "Title 2", "Main Owner 2", "New Owner 2", "BookId 2", "UserId 2"],
         ["ID 3" , "Title 3", "Main Owner 3", "New Owner 3", "BookId 3", "UserId 3"],
         ["ID 4" , "Title 4", "Main Owner 4", "New Owner 4", "BookId 4", "UserId 4"],
         ["ID 5" , "Title 5", "Main Owner 5", "New Owner 5", "BookId 5", "UserId 5"],
         ["ID 6" , "Title 6", "Main Owner 6", "New Owner 6", "BookId 6", "UserId 6"]]

    l, swapped_with = swap_table(l)
  </py-script>


  <script>
    function updateTime() {
    const timer = document.getElementById("timer");
    const enableButton = document.getElementById("enableButton");
    const container = document.querySelector(".w3-container");
  
    // Set the end date to 30 days from now
    const endDate = new Date();
    endDate.setDate(endDate.getDate() + 0);
  
    // Calculate the remaining time in milliseconds
    const remainingTime = endDate.getTime() - new Date().getTime();
  
    // Convert remaining time to days, hours, minutes, and seconds
    let remainingSeconds = Math.ceil(remainingTime / 1000);
    const remainingMinutes = Math.floor(remainingSeconds / 60);
    const remainingHours = Math.floor(remainingMinutes / 60);
    const remainingDays = Math.floor(remainingHours / 24);
  
    // Calculate the remaining time as a string
    const remainingTimeString = `${remainingDays}d ${remainingHours % 24}h ${remainingMinutes % 60}m ${remainingSeconds % 60}s`;
  
    // Update the timer element with the remaining time
    timer.innerHTML = remainingTimeString;
  
    // Change background color of the container based on remaining time
    if (remainingDays <= 5) {
      container.style.backgroundColor = "red";
    } else if (remainingDays <= 10) {
      container.style.backgroundColor = "yellow";
    } else {
      container.style.backgroundColor = "green";
    }
  
    // Enable the button after 30 days
    if (remainingTime <= 0) {
      enableButton.textContent = "SWAP";
      enableButton.disabled = false;
      enableButton.addEventListener("click", function(){
        location.reload();
      })
    }
    
    // Display countdown of hours, minutes, and seconds
    const minutesString = `${(remainingMinutes % 60).toString().padStart(2, "0")}:`;
    const secondsString = `${(remainingSeconds % 60).toString().padStart(2, "0")}`;
    timer.innerHTML = `${hoursString}${minutesString}${secondsString}`;
  
    // Stop the timer when remaining time reaches 0
    if (remainingTime <= 0) {
      clearInterval(intervalId);
      timer.innerHTML = `00:00:00 (0d 0h 0m 0s)`;
    }
  
    remainingSeconds--;
  }
  
  // Call the updateTime function every second
  const intervalId = setInterval(updateTime, 1000);
  
      </script>
    <!-- Header -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
    <div class="jumbotron">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <div class="col-xs-3">
                    <img class="img-responsive" src="logo.jpeg" alt="Book Logo">
                </div>
                <div class="col-xs-7">
                    <h1>The Reading Circle</h1>
                    <p>Experience the joy of reading with The Reading Circle - where every book is a new adventure!</p>
                </div>
            </div>
        </div>
    </div>

    <div class="w3-row-padding w3-content" style="max-width:1400px">
      <div class="w3-twothird">
        <!-- Timer bar -->
          <div class="w3-row-padding w3-content" style="max-width:1400px">
            <div class="w3-container w3-animate-zoom w3-left-align">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>Time remaining: <span id="timer"></span></h3>
                <button class="btn btn-primary" id="enableButton" disabled>Enable after 30 days</button>
              </div>
            </div>
          </div>
        <table class="table table-success table-striped table-hover" border="1">
          <thead>
              <tr>
                  <!-- <th>ID</th> -->
                  <th>Id</th>
                  <th>Title</th>
                  <th>Main Owner</th>
                  <th>New Owner</th>
                  <th>Book Id</th>
                  <th>User Id</th>
                   <th colspan="1">Actions</th>
              </tr>
          </thead>
        </table>
        <py-script> 
          for i in l:
            print(i) 
        </py-script>
      </div>
      <div class="w3-third">
        <div class="w3-container w3-light-grey">
          <h2>Swapped Table</h2>
          <table id="swapped-table" class="table table-success table-striped table-hover" border="1">
            <thead>
              <tr>
                <th>Previous Owner</th>
                <th>New Owner</th>
              </tr>
            </thead>
          </table>
          <p class="w3-justify"></p>
        </div>
        <py-script> 
          for j in swapped_with:
            print(j) 
          </py-script>
      </div>      
      </div>
      </div>    
    </div>
</body>
</html>

{% endblock %}